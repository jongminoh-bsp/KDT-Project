name: ğŸš€ Custom Slack Notifications

on:
  push:
    branches: [ main, develop, staging ]
  pull_request:
    types: [opened, closed, merged]
  issues:
    types: [opened, closed]
  release:
    types: [published]

jobs:
  slack-notify:
    runs-on: ubuntu-latest
    steps:
    - name: ğŸ“¥ Checkout
      uses: actions/checkout@v4
      
    - name: ğŸ“Š Get Commit Info
      id: commit
      run: |
        echo "author=$(git log -1 --pretty=format:'%an')" >> $GITHUB_OUTPUT
        echo "message=$(git log -1 --pretty=format:'%s')" >> $GITHUB_OUTPUT
        echo "hash=$(git log -1 --pretty=format:'%h')" >> $GITHUB_OUTPUT
        echo "timestamp=$(date -u)" >> $GITHUB_OUTPUT
        
    - name: ğŸ“¢ Push Notification
      if: github.event_name == 'push'
      run: |
        curl -X POST -H 'Content-type: application/json' \
        --data '{
          "channel": "#infrastructure",
          "username": "GitHub Bot",
          "icon_emoji": ":rocket:",
          "text": "ğŸš€ ìƒˆë¡œìš´ ì½”ë“œê°€ í‘¸ì‹œë˜ì—ˆìŠµë‹ˆë‹¤!",
          "attachments": [{
            "color": "good",
            "title": "ğŸ“‹ ì»¤ë°‹ ì •ë³´",
            "fields": [
              {
                "title": "ğŸ‘¤ ì‘ì„±ì",
                "value": "${{ steps.commit.outputs.author }}",
                "short": true
              },
              {
                "title": "ğŸŒ¿ ë¸Œëœì¹˜",
                "value": "${{ github.ref_name }}",
                "short": true
              },
              {
                "title": "ğŸ’¬ ë©”ì‹œì§€",
                "value": "${{ steps.commit.outputs.message }}",
                "short": false
              },
              {
                "title": "ğŸ”— ë§í¬",
                "value": "<${{ github.server_url }}/${{ github.repository }}/commit/${{ github.sha }}|${{ steps.commit.outputs.hash }}>",
                "short": true
              }
            ],
            "footer": "KDT Project",
            "ts": "${{ github.event.head_commit.timestamp }}"
          }]
        }' \
        ${{ secrets.SLACK_WEBHOOK_URL }}
        
    - name: ğŸ“ PR Notification
      if: github.event_name == 'pull_request'
      run: |
        ACTION_COLOR="warning"
        ACTION_EMOJI=":eyes:"
        ACTION_TEXT="PRì´ ì—´ë ¸ìŠµë‹ˆë‹¤"
        
        if [ "${{ github.event.action }}" = "closed" ]; then
          if [ "${{ github.event.pull_request.merged }}" = "true" ]; then
            ACTION_COLOR="good"
            ACTION_EMOJI=":white_check_mark:"
            ACTION_TEXT="PRì´ ë¨¸ì§€ë˜ì—ˆìŠµë‹ˆë‹¤"
          else
            ACTION_COLOR="danger"
            ACTION_EMOJI=":x:"
            ACTION_TEXT="PRì´ ë‹«í˜”ìŠµë‹ˆë‹¤"
          fi
        fi
        
        curl -X POST -H 'Content-type: application/json' \
        --data "{
          \"channel\": \"#infrastructure\",
          \"username\": \"GitHub Bot\",
          \"icon_emoji\": \"$ACTION_EMOJI\",
          \"text\": \"$ACTION_EMOJI $ACTION_TEXT\",
          \"attachments\": [{
            \"color\": \"$ACTION_COLOR\",
            \"title\": \"ğŸ“‹ PR ì •ë³´: ${{ github.event.pull_request.title }}\",
            \"fields\": [
              {
                \"title\": \"ğŸ‘¤ ì‘ì„±ì\",
                \"value\": \"${{ github.event.pull_request.user.login }}\",
                \"short\": true
              },
              {
                \"title\": \"ğŸŒ¿ ë¸Œëœì¹˜\",
                \"value\": \"${{ github.event.pull_request.head.ref }} â†’ ${{ github.event.pull_request.base.ref }}\",
                \"short\": true
              },
              {
                \"title\": \"ğŸ“ ì„¤ëª…\",
                \"value\": \"${{ github.event.pull_request.body }}\",
                \"short\": false
              },
              {
                \"title\": \"ğŸ”— ë§í¬\",
                \"value\": \"<${{ github.event.pull_request.html_url }}|PR ë³´ê¸°>\",
                \"short\": true
              }
            ],
            \"footer\": \"KDT Project\"
          }]
        }" \
        ${{ secrets.SLACK_WEBHOOK_URL }}
        
    - name: ğŸ› Issue Notification
      if: github.event_name == 'issues'
      run: |
        ACTION_COLOR="warning"
        ACTION_EMOJI=":bug:"
        ACTION_TEXT="ìƒˆ ì´ìŠˆê°€ ìƒì„±ë˜ì—ˆìŠµë‹ˆë‹¤"
        
        if [ "${{ github.event.action }}" = "closed" ]; then
          ACTION_COLOR="good"
          ACTION_EMOJI=":white_check_mark:"
          ACTION_TEXT="ì´ìŠˆê°€ í•´ê²°ë˜ì—ˆìŠµë‹ˆë‹¤"
        fi
        
        curl -X POST -H 'Content-type: application/json' \
        --data "{
          \"channel\": \"#infrastructure\",
          \"username\": \"GitHub Bot\",
          \"icon_emoji\": \"$ACTION_EMOJI\",
          \"text\": \"$ACTION_EMOJI $ACTION_TEXT\",
          \"attachments\": [{
            \"color\": \"$ACTION_COLOR\",
            \"title\": \"ğŸ› ì´ìŠˆ: ${{ github.event.issue.title }}\",
            \"fields\": [
              {
                \"title\": \"ğŸ‘¤ ì‘ì„±ì\",
                \"value\": \"${{ github.event.issue.user.login }}\",
                \"short\": true
              },
              {
                \"title\": \"ğŸ·ï¸ ë¼ë²¨\",
                \"value\": \"${{ join(github.event.issue.labels.*.name, ', ') }}\",
                \"short\": true
              },
              {
                \"title\": \"ğŸ“ ë‚´ìš©\",
                \"value\": \"${{ github.event.issue.body }}\",
                \"short\": false
              },
              {
                \"title\": \"ğŸ”— ë§í¬\",
                \"value\": \"<${{ github.event.issue.html_url }}|ì´ìŠˆ ë³´ê¸°>\",
                \"short\": true
              }
            ],
            \"footer\": \"KDT Project\"
          }]
        }" \
        ${{ secrets.SLACK_WEBHOOK_URL }}
        
    - name: ğŸ‰ Release Notification
      if: github.event_name == 'release'
      run: |
        curl -X POST -H 'Content-type: application/json' \
        --data '{
          "channel": "#infrastructure",
          "username": "GitHub Bot",
          "icon_emoji": ":tada:",
          "text": "ğŸ‰ ìƒˆë¡œìš´ ë¦´ë¦¬ì¦ˆê°€ ë°°í¬ë˜ì—ˆìŠµë‹ˆë‹¤!",
          "attachments": [{
            "color": "#ff6b35",
            "title": "ğŸš€ ë¦´ë¦¬ì¦ˆ: ${{ github.event.release.tag_name }}",
            "fields": [
              {
                "title": "ğŸ“‹ ì œëª©",
                "value": "${{ github.event.release.name }}",
                "short": true
              },
              {
                "title": "ğŸ‘¤ ë°°í¬ì",
                "value": "${{ github.event.release.author.login }}",
                "short": true
              },
              {
                "title": "ğŸ“ ë¦´ë¦¬ì¦ˆ ë…¸íŠ¸",
                "value": "${{ github.event.release.body }}",
                "short": false
              },
              {
                "title": "ğŸ”— ë‹¤ìš´ë¡œë“œ",
                "value": "<${{ github.event.release.html_url }}|ë¦´ë¦¬ì¦ˆ ë³´ê¸°>",
                "short": true
              }
            ],
            "footer": "KDT Project"
          }]
        }' \
        ${{ secrets.SLACK_WEBHOOK_URL }}
