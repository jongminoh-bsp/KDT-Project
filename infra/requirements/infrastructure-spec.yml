# ğŸ—ï¸ Infrastructure Requirements Specification

metadata:
  name: "kdt-project-infrastructure"
  version: "1.0.0"
  environment: "dev"
  owner: "kdt-team"
  description: "KDT í”„ë¡œì íŠ¸ ê°œë°œ í™˜ê²½ ì¸í”„ë¼ - ìë™ í¬ë§· ê¸°ëŠ¥ ì¶”ê°€ ì™„ë£Œ"

# ğŸ—‘ï¸ Infrastructure Management
management:
  unused_resource_scan:
    trigger: true  # ë¯¸ì‚¬ìš© ë¦¬ì†ŒìŠ¤ ìŠ¤ìº”í•´ì¤˜
    timestamp: "2025-09-19T09:10:54"

# ë¦¬ì†ŒìŠ¤ ìµœì í™” ì„¤ì •
optimization:
  unused_resource_scan:
    enabled: true
    schedule: "weekly"  # daily, weekly, monthly
    snapshot_retention_days: 30
    auto_cleanup: false  # trueë¡œ ì„¤ì •í•˜ë©´ ìë™ ì •ë¦¬
    notification: true
    trigger: true  # ë¯¸ì‚¬ìš© ë¦¬ì†ŒìŠ¤ ìŠ¤ìºë„ˆ ì‹¤í–‰ (ê°œì„ ëœ ì¼ì‹œ í‘œì‹œ)

# ğŸŒ ë„¤íŠ¸ì›Œí¬ ì„¤ì •
network:
  vpc:
    cidr: "10.30.0.0/16"
    enable_dns_hostnames: true
    enable_dns_support: true
  
  subnets:
    public:
      - cidr: "10.30.10.0/24"
        az: "ap-northeast-2a"
      - cidr: "10.30.20.0/24"
        az: "ap-northeast-2c"
    
    private_mgmt:
      - cidr: "10.30.11.0/24"
        az: "ap-northeast-2a"
      - cidr: "10.30.21.0/24"
        az: "ap-northeast-2c"
    
    private_nodegroup:
      - cidr: "10.30.12.0/23"
        az: "ap-northeast-2a"
      - cidr: "10.30.22.0/23"
        az: "ap-northeast-2c"
    
    private_rds:
      - cidr: "10.30.14.0/24"
        az: "ap-northeast-2a"
      - cidr: "10.30.24.0/24"
        az: "ap-northeast-2c"
    
    private_qdev:
      - cidr: "10.30.15.0/24"
        az: "ap-northeast-2a"
      - cidr: "10.30.25.0/24"
        az: "ap-northeast-2c"

# ğŸ–¥ï¸ ì»´í“¨íŒ… ë¦¬ì†ŒìŠ¤
compute:
  ec2:
    management:
      instance_type: "t3.medium"
      ami: "ami-0d5bb3742db8fc264"  # Amazon Linux 2023
      key_name: "ojm-key"
      enable_ssm: true
    
    qdev:
      instance_type: "t3.medium"
      ami: "ami-0d5bb3742db8fc264"
      key_name: "ojm-key"
      enable_ssm: true

# â˜¸ï¸ Kubernetes í´ëŸ¬ìŠ¤í„°
kubernetes:
  eks:
    cluster_name: "kdt-dev-eks-cluster"
    version: "1.33"
    endpoint_private_access: true
    endpoint_public_access: true
    
    node_groups:
      main:
        instance_types: ["t3.medium"]
        ami_type: "AL2023_x86_64_STANDARD"
        capacity_type: "ON_DEMAND"
        scaling:
          desired_size: 2
          min_size: 2
          max_size: 4
        disk_size: 20
        
    addons:
      - name: "vpc-cni"
        version: "latest"
      - name: "coredns"
        version: "latest"
      - name: "kube-proxy"
        version: "latest"

# ğŸ—„ï¸ ë°ì´í„°ë² ì´ìŠ¤
database:
  rds:
    engine: "mysql"
    engine_version: "8.0.41"
    instance_class: "db.t3.micro"
    allocated_storage: 20
    storage_type: "gp2"
    storage_encrypted: true
    
    database_name: "skyline"
    username: "ojm"
    # passwordëŠ” AWS Secrets Managerì—ì„œ ìë™ ìƒì„±
    
    backup:
      retention_period: 7
      window: "03:00-04:00"
    
    maintenance:
      window: "sun:04:00-sun:05:00"
    
    multi_az: false
    publicly_accessible: false

# ğŸ”’ ë³´ì•ˆ ì„¤ì •
security:
  security_groups:
    management:
      description: "Security group for management instances"
      rules:
        egress:
          - protocol: "-1"
            from_port: 0
            to_port: 0
            cidr_blocks: ["0.0.0.0/0"]
    
    nodegroup:
      description: "Security group for EKS node group"
      rules:
        ingress:
          - protocol: "tcp"
            from_port: 0
            to_port: 65535
            self: true
        egress:
          - protocol: "-1"
            from_port: 0
            to_port: 0
            cidr_blocks: ["0.0.0.0/0"]
    
    cluster:
      description: "Security group for EKS cluster"
      rules:
        egress:
          - protocol: "-1"
            from_port: 0
            to_port: 0
            cidr_blocks: ["0.0.0.0/0"]
    
    database:
      description: "Security group for RDS database"
      rules:
        ingress:
          - protocol: "tcp"
            from_port: 3306
            to_port: 3306
            source_security_group: "nodegroup"
        egress:
          - protocol: "-1"
            from_port: 0
            to_port: 0
            cidr_blocks: ["0.0.0.0/0"]
    
    qdev:
      description: "Security group for Q Developer instances"
      rules:
        egress:
          - protocol: "tcp"
            from_port: 443
            to_port: 443
            cidr_blocks: ["0.0.0.0/0"]
            description: "Allow HTTPS for SSM access"

# ğŸ·ï¸ íƒœê¹… ì „ëµ
tags:
  common:
    Project: "kdt"
    Environment: "dev"
    ManagedBy: "terraform"
    Owner: "kdt-team"
    
  cost_allocation:
    CostCenter: "development"
    Team: "kdt-team"

# ğŸ’° ë¹„ìš© ìµœì í™”
cost_optimization:
  auto_scaling:
    enabled: true
    scale_down_delay: "10m"
    scale_up_delay: "3m"
  
  spot_instances:
    enabled: false  # ê°œë°œ í™˜ê²½ì—ì„œëŠ” ì•ˆì •ì„± ìš°ì„ 
    
  scheduled_actions:
    - name: "scale-down-evening"
      schedule: "0 18 * * MON-FRI"  # í‰ì¼ ì˜¤í›„ 6ì‹œ
      min_size: 0
      max_size: 1
      desired_capacity: 0
    
    - name: "scale-up-morning"
      schedule: "0 9 * * MON-FRI"   # í‰ì¼ ì˜¤ì „ 9ì‹œ
      min_size: 1
      max_size: 3
      desired_capacity: 2

# ğŸ“Š ëª¨ë‹ˆí„°ë§ ë° ë¡œê¹…
monitoring:
  cloudwatch:
    log_retention_days: 90
    enable_container_insights: true
    
  metrics:
    - namespace: "AWS/EKS"
      metrics: ["cluster_failed_request_count", "cluster_request_total"]
    - namespace: "AWS/EC2"
      metrics: ["CPUUtilization", "NetworkIn", "NetworkOut"]
    - namespace: "AWS/RDS"
      metrics: ["CPUUtilization", "DatabaseConnections"]

# ğŸš€ ë°°í¬ ì„¤ì •
deployment:
  strategy: "rolling_update"
  
  environments:
    dev:
      auto_apply: true
      require_approval: false
    
    staging:
      auto_apply: false
      require_approval: true
      approvers: ["kdt-team"]
    
    prod:
      auto_apply: false
      require_approval: true
      approvers: ["kdt-team", "ops-team"]
      
  notifications:
    slack:
      enabled: true
      webhook_url: ""  # GitHub Secretsì—ì„œ SLACK_WEBHOOK_URLë¡œ ê´€ë¦¬
    
    email:
      enabled: false
      recipients: []
# ìƒˆë¡œìš´ ìš”êµ¬ì‚¬í•­ ì¶”ê°€
